<!doctype html>
<html lang="zh">
    <head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff">
    <title>
        图片加载库 - 东方回声
    </title>
    <meta name="description" content="图片加载库相关,Bitmap如何预防OOM">
    <meta name="author" content="plucky">
    <meta vmid="keywords" name="keywords" content="来自东方的声音">
    <link rel="shortcut icon" href="../assets/favicon.ico"
        type="image/x-icon">
    <link rel="icon" href="../assets/favicon.ico"
        type="image/x-icon">
    <script src="../js/dt.js"></script>
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/jquery.svg.js"></script>
    <link rel="stylesheet"
        href="../css/bytedesign.min.css">
    <link rel="stylesheet"
        href="../css/app.css">
    <link rel="stylesheet"
        href="../css/default.css">
    <link rel="stylesheet"
        href="../css/jj.css">
    
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1427835_zgyohh6l1si.css">
    
    <style>
            .footer-tag.width-limited{
                max-width: 120px !important;
            }
        </style>
</head>
    <body>
        <link rel="stylesheet" href="../css/plugins.css">
        <link rel="stylesheet" href="../css/post.css">
        <script src="../js/plugins.js"></script>
        <link
            href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
            rel="stylesheet">
        <script
            src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
        <link rel="stylesheet"
            href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/11.3be290f.css">
        <div data-server-rendered="true" id="__nuxt">
            <div id="__layout">
                <div id="juejin">
                    <div class="view-container" data-v-5762947c data-v-125fc212>
                        <div class="main-header-box" data-v-5762947c>
    <header data-fetch-key="0"
        class="main-header main-header visible"
        data-v-0bba9d46 data-v-5762947c>
        <div class="container" data-v-0bba9d46>
            <a href="../index.html" class="logo" data-v-0bba9d46>
                <img
                    src="../assets/logo.svg"
                    alt="稀土掘金" class="logo-img" data-v-0bba9d46>
                <img
                    src="../assets/logo_mini.svg"
                    alt="稀土掘金" class="mobile" data-v-0bba9d46>
            </a>
            <!---->
            <nav role="navigation" class="main-nav" data-v-0bba9d46>
                <ul class="nav-list" data-v-0bba9d46>
                    <!---->
                    <li class="main-nav-list" data-v-0bba9d46>
                        <div class="phone-show-menu" data-v-0bba9d46>
                            <span data-v-0bba9d46 id="active_title">
                                首页
                            </span>
                            <svg width="12" height="12" viewBox="0 0 12 12"
                                fill="none" xmlns="http://www.w3.org/2000/svg"
                                class="unfold16-icon" data-v-0bba9d46
                                data-v-0bba9d46>
                                <path
                                    d="M2.45025 4.82431C2.17422 4.49957 2.40501 4.00049 2.83122 4.00049H9.16878C9.59498 4.00049 9.82578 4.49957 9.54975 4.82431L6.38097 8.55229C6.1813 8.78719 5.8187 8.78719 5.61903 8.55229L2.45025 4.82431Z"
                                    data-v-0bba9d46 data-v-0bba9d46>
                                </path>
                            </svg>
                        </div>
                        <ul class="phone-hide" data-v-0bba9d46>
                            <li
                                class="nav-item link-item "
                                data-v-0bba9d46>
                                <a href="../index.html"
                                    data-v-0bba9d46>
                                    首页
                                </a>
                            </li>
                            <li
                                class="nav-item link-item activities "
                                data-v-0bba9d46>
                                <a href="../hollow.html"
                                    data-v-0bba9d46>
                                    树洞
                                    <span class="text" data-v-0bba9d46>
                                        <!---->
                                    </span>
                                </a>
                            </li>
                            <li
                                class="nav-item link-item "
                                data-v-0bba9d46>
                                <a href="../events.html"
                                    data-v-0bba9d46>
                                    活动
                                </a>
                            </li>

                            <nav
                                class="nav-item link-item download-icon "
                                data-v-0bba9d46>
                                <a href="../app.html"
                                    class="download-app no-border"
                                    data-v-0bba9d46>
                                    APP
                                </a>
                            </nav>
                            <nav
                                class="nav-item link-item extension-icon "
                                data-v-0bba9d46>
                                <a
                                    href="../plugins.html"
                                    rel="nofollow noopener noreferrer"
                                    class="broswer-extension no-border"
                                    data-v-0bba9d46>
                                    <span data-v-0bba9d46>
                                        插件
                                    </span>
                                </a>
                            </nav>
                            <!---->
                        </ul>
                    </li>
                    <ul class="right-side-nav" data-v-0bba9d46>
                        <li class="search-add" data-v-0bba9d46>
                            <ul class="search-add-ul" data-v-0bba9d46>
                                <li class="nav-item search" data-v-0bba9d46
                                    id="li_search">
                                    <form role="search" class="search-form"
                                        data-v-0bba9d46>
                                        <input type="search" maxlength="64"
                                            placeholder
                                            value class="search-input"
                                            data-v-0bba9d46>
                                        <div class="seach-icon-container"
                                            data-v-0bba9d46>
                                            <svg width="18" height="18"
                                                viewBox="0 0 18 18" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="search-icon"
                                                id="search_icon_x"
                                                data-v-0bba9d46
                                                data-v-0bba9d46>
                                                <path
                                                    d="M12.4008 12.4008C14.744 10.0577 14.744 6.25871 12.4008 3.91556C10.0577 1.57242 6.25871 1.57242 3.91556 3.91556C1.57242 6.25871 1.57242 10.0577 3.91556 12.4008C6.25871 14.744 10.0577 14.744 12.4008 12.4008ZM12.4008 12.4008L15.5828 15.5828"
                                                    stroke-width="1.5"
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    data-v-0bba9d46
                                                    data-v-0bba9d46>
                                                </path>
                                            </svg>
                                        </div>
                                        <!---->
                                        <div class="typehead"
                                            style="display:none;"
                                            data-v-0bba9d46>
                                            <!---->
                                            <div class="title" data-v-0bba9d46>
                                                <span data-v-0bba9d46>
                                                    搜索历史
                                                </span>
                                                <span class="clear"
                                                    data-v-0bba9d46>
                                                    清空
                                                </span>
                                            </div>
                                            <div class="list" data-v-0bba9d46>
                                            </div>
                                        </div>
                                    </form>
                                </li>
                                <li class="nav-item add creator-item"
                                    id="li_add"
                                    data-v-0bba9d46>
                                    <div class="add-group" data-v-17cc1c49
                                        data-v-0bba9d46>
                                        <!---->
                                        <button class="add-btn" data-v-17cc1c49>
                                            创作者中心
                                        </button>
                                        <div class="more" data-v-17cc1c49>
                                            <svg width="12" height="12"
                                                viewBox="0 0 12 12" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="unfold12-icon"
                                                data-v-17cc1c49
                                                data-v-17cc1c49>
                                                <path
                                                    d="M2.45025 4.82383C2.17422 4.49908 2.40501 4 2.83122 4H9.16878C9.59499 4 9.82578 4.49908 9.54975 4.82382L6.38097 8.5518C6.1813 8.7867 5.8187 8.7867 5.61903 8.5518L2.45025 4.82383Z"
                                                    fill="white" data-v-17cc1c49
                                                    data-v-17cc1c49>
                                                </path>
                                            </svg>
                                            <div class="more-mask"
                                                data-v-17cc1c49>
                                            </div>
                                            <div class="more-list"
                                                data-v-17cc1c49><ul
                                                    class="menu" data-v-17cc1c49><li
                                                        class="item"
                                                        data-v-17cc1c49><div
                                                            class="icon write-article"
                                                            data-v-17cc1c49></div>
                                                        <div
                                                            class="title"
                                                            data-v-17cc1c49>写文章</div></li><li
                                                        class="item"
                                                        data-v-17cc1c49><div
                                                            class="icon issue-points"
                                                            data-v-17cc1c49></div>
                                                        <div
                                                            class="title"
                                                            data-v-17cc1c49>发沸点</div></li><li
                                                        class="item"
                                                        data-v-17cc1c49><div
                                                            class="icon write-note"
                                                            data-v-17cc1c49></div>
                                                        <div
                                                            class="title"
                                                            data-v-17cc1c49>写笔记</div></li><li
                                                        class="item"
                                                        data-v-17cc1c49><div
                                                            class="icon create-jcode"
                                                            data-v-17cc1c49></div>
                                                        <div
                                                            class="title"
                                                            data-v-17cc1c49>写代码</div></li><li
                                                        class="item"
                                                        data-v-17cc1c49><div
                                                            class="icon drafts"
                                                            data-v-17cc1c49></div>
                                                        <div class="title"
                                                            data-v-17cc1c49>草稿箱</div></li></ul>
                                                <div class="divider"
                                                    data-v-17cc1c49></div>
                                                <div class="inspiration"
                                                    data-v-17cc1c49><div
                                                        class="info"
                                                        data-v-17cc1c49><span
                                                            class="title"
                                                            data-v-17cc1c49>创作灵感</span>
                                                        <span class="more-info"
                                                            data-v-17cc1c49>
                                                            查看更多
                                                            <i
                                                                class="icon byte-icon byte-icon--right"
                                                                data-v-17cc1c49><svg
                                                                    t="1561636167146"
                                                                    class="icon"
                                                                    viewBox="0 0 1024 1024"
                                                                    version="1.1"
                                                                    xmlns="http://www.w3.org/2000/svg"
                                                                    p-id="404349"
                                                                    xmlns:xlink="http://www.w3.org/1999/xlink"><path
                                                                        d="M630.4 512L283.52 165.12a21.12 21.12 0 0 1 0-30.08l30.08-30.08a21.12 21.12 0 0 1 30.08 0l377.6 376.96a42.24 42.24 0 0 1 0 60.16l-377.6 376.96a21.12 21.12 0 0 1-30.08 0l-30.08-30.08a21.12 21.12 0 0 1 0-30.08z"
                                                                        p-id="404350"></path></svg></i></span></div>
                                                    <div class="list"
                                                        data-v-17cc1c49><div
                                                            data-v-17cc1c49
                                                            class="item"><span
                                                                data-v-17cc1c49
                                                                class="icon icon-activity">热门</span>
                                                            <span
                                                                data-v-17cc1c49
                                                                class="title">写原创好文，瓜分万元现金大奖
                                                                💰 </span></div><div
                                                            data-v-17cc1c49
                                                            class="item"><span
                                                                data-v-17cc1c49
                                                                class="icon icon-activity">热门</span>
                                                            <span
                                                                data-v-17cc1c49
                                                                class="title">快速搬家，掘金写作之旅即刻启航！</span></div>
                                                        <div data-v-17cc1c49
                                                            class="item"><span
                                                                data-v-17cc1c49
                                                                class="icon icon-topic">话题</span>
                                                            <span
                                                                data-v-17cc1c49
                                                                class="title topic-title">1024一起掘金</span></div>
                                                        <div class="item"
                                                            data-v-090682e2
                                                            data-v-17cc1c49></div></div></div></div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </ul>
            </nav>
        </div>
    </header>
    <script type="text/javascript">
        $(".search-input").focus(()=>{
            $("#li_search").addClass("active");
            $(".search-form").addClass("active");
            $("#search_icon_x").attr('class',"active search-icon");
            $("#li_add").addClass("hide");
        });
        $(".search-input").focusout(()=>{
            $("#li_search").removeClass("active");
            $("#li_add").removeClass("hide");
            $(".search-form").removeClass("active");
            $("#search_icon_x").attr('class',"search-icon");
        });
        $(".phone-show-menu").click(()=>{
            $(".phone-hide").addClass("show");
        });
        $("body").click((e)=>{
            let ele = $(".phone-show-menu");
            if (!ele.is(e.target) && ele.has(e.target).length==0) {
                $(".phone-hide").removeClass("show");    
            }
        });
        $(()=>{
            $("#active_title").text($(".phone-hide>.nav-item.active").text());
        });
    </script>
</div>
                        <main class="container main-container"
                            style="max-width:1140px;"
                            data-v-5762947c>
                            <div class="view column-view"
                                data-v-5762947c
                                data-v-125fc212> <div
                                    class="main-area article-area"
                                    data-v-5762947c data-v-125fc212>
                                    <article itemscope="itemscope"
                                        itemtype="http://schema.org/Article"
                                        data-entry-id="7022606372126588941"
                                        data-draft-id="7022605269393735717"
                                        data-original-type="0"
                                        class="article"
                                        data-v-125fc212 data-v-5762947c>
                                        <h1 class="article-title"
                                            data-v-125fc212>
                                            图片加载库
                                        </h1>
                                        <div class="author-info-block"
    data-v-125fc212>
    <div class="author-info-box"
        data-v-125fc212>
        <div class="author-name"
            data-v-125fc212>
            <a
                href="/user/2190663523246765/posts"
                target="_blank"
                rel
                class="username username ellipsis"
                data-v-1800aadb
                data-v-125fc212>
                <span class="name"
                    style="max-width:160px;"
                    data-v-1800aadb>
                    default
                </span>

            </a>
        </div>
        <div class="meta-box"
            data-v-125fc212>
            <time
                class="time"
                data-v-125fc212>
                2022-12-15 21:14:27
            </time>
            <svg width="16" height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                class="read-icon"
                data-v-125fc212>
                <path
                    d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z"
                    stroke="currentColor"
                    data-v-125fc212>
                </path>
                <circle cx="7.89922"
                    cy="8.00078" r="2.2"
                    stroke="currentColor"
                    data-v-125fc212>
                </circle>
            </svg>
            
            <script async
                src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_value_page_pv" class="views-count"
                data-v-125fc212>
                0
            </span>
            
        </div>
    </div>
    <div style="flex:1;" data-v-125fc212>
    </div>
</div>
                                        <div id="article-root"
                                            itemprop="articleBody"
                                            class="article-viewer markdown-body cache result"
                                            data-v-125fc212>
                                            <blockquote>
<p> 一般情况下可对图片进行压缩处理，没必要直接显示原图。如果需要显示高清图，可以使用SubsamplingScaleImageView，缩放的时候通过Matrix仅显示局部。</p>
</blockquote>
<h3 id="异步">异步</h3><ul>
<li>Fresco (Facebook)</li><li>Universal Image Loader</li><li>Piccaso (square)</li></ul>
<h3 id="bitmapfactory#decodexxx 为什么 在 debug 点击 viewbitmap时 看到的 bitmap  与实际图片不一致，和 view 绘制出来的也不一致">BitmapFactory#decodeXXX 为什么 在 Debug 点击 ViewBitmap时 看到的 Bitmap  与实际图片不一致，和 View 绘制出来的也不一致</h3><h4 id="解决方案">解决方案</h4><pre><code>// it 表示有问题的Bitmap
BitmapFactory.decodeStream(it.toInputStream(100, Bitmap.CompressFormat.PNG), null, BitmapFactory.Options().apply {
                inPreferredConfig = Bitmap.Config.ARGB_8888
                // 重点是以下两行代码
                inPremultiplied = false
                // 默认为 true 为防止其他地方修改 强制设置成true
                inScaled = true

            })
</code></pre><h4 id="字段含义">字段含义</h4><pre><code>/**
 * BitmapFactory#Options#inPremultiplied
 * If true (which is the default), the resulting bitmap will have its
 * color channels pre-multipled by the alpha channel.
 *
 * &lt;p&gt;This should NOT be set to false for images to be directly drawn by
 * the view system or through a {@link Canvas}. The view system and
 * {@link Canvas} assume all drawn images are pre-multiplied to simplify
 * draw-time blending, and will throw a RuntimeException when
 * un-premultiplied are drawn.&lt;/p&gt;
 *
 * &lt;p&gt;This is likely only useful if you want to manipulate raw encoded
 * image data, e.g. with RenderScript or custom OpenGL.&lt;/p&gt;
 *
 * &lt;p&gt;This does not affect bitmaps without an alpha channel.&lt;/p&gt;
 *
 * &lt;p&gt;Setting this flag to false while setting {@link #inScaled} to true
 * may result in incorrect colors.&lt;/p&gt;
 *
 * @see Bitmap#hasAlpha()
 * @see Bitmap#isPremultiplied()
 * @see #inScaled
 */
public boolean inPremultiplied;

/**  Bitmap#isPremultiplied
 * &lt;p&gt;Indicates whether pixels stored in this bitmaps are stored pre-multiplied.
 * When a pixel is pre-multiplied, the RGB components have been multiplied by
 * the alpha component. For instance, if the original color is a 50%
 * translucent red &lt;code&gt;(128, 255, 0, 0)&lt;/code&gt;, the pre-multiplied form is
 * &lt;code&gt;(128, 128, 0, 0)&lt;/code&gt;.&lt;/p&gt;
 *
 * &lt;p&gt;This method always returns false if {@link #getConfig()} is
 * {@link Bitmap.Config#RGB_565}.&lt;/p&gt;
 *
 * &lt;p&gt;The return value is undefined if {@link #getConfig()} is
 * {@link Bitmap.Config#ALPHA_8}.&lt;/p&gt;
 *
 * &lt;p&gt;This method only returns true if {@link #hasAlpha()} returns true.
 * A bitmap with no alpha channel can be used both as a pre-multiplied and
 * as a non pre-multiplied bitmap.&lt;/p&gt;
 *
 * &lt;p&gt;Only pre-multiplied bitmaps may be drawn by the view system or
 * {@link Canvas}. If a non-pre-multiplied bitmap with an alpha channel is
 * drawn to a Canvas, a RuntimeException will be thrown.&lt;/p&gt;
 *
 * @return true if the underlying pixels have been pre-multiplied, false
 *         otherwise
 *
 * @see Bitmap#setPremultiplied(boolean)
 * @see BitmapFactory.Options#inPremultiplied
 */
public final boolean isPremultiplied() {
    if (mRecycled) {
        Log.w(TAG, &quot;Called isPremultiplied() on a recycle()&#39;d bitmap! This is undefined behavior!&quot;);
    }
    return nativeIsPremultiplied(mNativePtr);
}

/** Bitmap#setPremultiplied
 * Sets whether the bitmap should treat its data as pre-multiplied.
 *
 * &lt;p&gt;Bitmaps are always treated as pre-multiplied by the view system and
 * {@link Canvas} for performance reasons. Storing un-pre-multiplied data in
 * a Bitmap (through {@link #setPixel}, {@link #setPixels}, or {@link
 * BitmapFactory.Options#inPremultiplied BitmapFactory.Options.inPremultiplied})
 * can lead to incorrect blending if drawn by the framework.&lt;/p&gt;
 *
 * &lt;p&gt;This method will not affect the behavior of a bitmap without an alpha
 * channel, or if {@link #hasAlpha()} returns false.&lt;/p&gt;
 *
 * &lt;p&gt;Calling {@link #createBitmap} or {@link #createScaledBitmap} with a source
 * Bitmap whose colors are not pre-multiplied may result in a RuntimeException,
 * since those functions require drawing the source, which is not supported for
 * un-pre-multiplied Bitmaps.&lt;/p&gt;
 *
 * @see Bitmap#isPremultiplied()
 * @see BitmapFactory.Options#inPremultiplied
 */
public final void setPremultiplied(boolean premultiplied) {
    checkRecycled(&quot;setPremultiplied called on a recycled bitmap&quot;);
    mRequestPremultiplied = premultiplied;
    nativeSetPremultiplied(mNativePtr, premultiplied);
}
</code></pre><h3 id="gpu-">GPU?</h3><pre><code>/**
 * Builds caches associated with the bitmap that are used for drawing it.
 *
 * &lt;p&gt;Starting in {@link android.os.Build.VERSION_CODES#N}, this call initiates an asynchronous
 * upload to the GPU on RenderThread, if the Bitmap is not already uploaded. With Hardware
 * Acceleration, Bitmaps must be uploaded to the GPU in order to be rendered. This is done by
 * default the first time a Bitmap is drawn, but the process can take several milliseconds,
 * depending on the size of the Bitmap. Each time a Bitmap is modified and drawn again, it must
 * be re-uploaded.&lt;/p&gt;
 *
 * &lt;p&gt;Calling this method in advance can save time in the first frame it&#39;s used. For example, it
 * is recommended to call this on an image decoding worker thread when a decoded Bitmap is about
 * to be displayed. It is recommended to make any pre-draw modifications to the Bitmap before
 * calling this method, so the cached, uploaded copy may be reused without re-uploading.&lt;/p&gt;
 *
 * In {@link android.os.Build.VERSION_CODES#KITKAT} and below, for purgeable bitmaps, this call
 * would attempt to ensure that the pixels have been decoded.
 */
public void prepareToDraw() {
    checkRecycled(&quot;Can&#39;t prepareToDraw on a recycled bitmap!&quot;);
    // Kick off an update/upload of the bitmap outside of the normal
    // draw path.
    nativePrepareToDraw(mNativePtr);
}
</code></pre><h4 id="更多参数">更多参数</h4><div class='table-responsive'><table><thead><tr>
<th style="text-align:center">参数</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">备注</th>
</tr>
</thead><tr>
<td style="text-align:center">inJustDecodeBounds</td>
<td style="text-align:left">为true时，解码不会返回bitmap，只会返回bitmap的尺寸。</td>
<td style="text-align:left">用于获取图片的尺寸，但有不想将其加载到内存中。</td>
</tr>
<tr>
<td style="text-align:center">inSampleSize</td>
<td style="text-align:left">当&lt;1时，当做1处理；&gt;1时会按照比例缩小bitmap的宽高，降低分辨率。</td>
<td style="text-align:left">如with=100,height=100,inSampleSize=2,则返回width=50,height=50,像素50*50=250降为1/4；</td>
</tr>
<tr>
<td style="text-align:center">inPreferredConfig</td>
<td style="text-align:left">色彩模式，默认ARGB_8888，一个像素4bytes。如果对透明不做要求，采用RGB_565，一个像素2bytes；</td>
<td style="text-align:left">ALPHA_8：每个像素1byte；ARGB_444：每个像素2byte；ARGB_8888：每个像素4byte；RGB_565：每个像素2byte；如果一个图片分辨率1024<em>768，采用ARGB_8888，占用空间为1024</em>768*4=3M，而采用ARGB_444内存就能减半1.5M;</td>
</tr>
<tr>
<td style="text-align:center">inPremultiplied</td>
<td style="text-align:left">和透明通道有关，默认true，返回的bitmap颜色通道上预先附加透明通道；</td>
<td style="text-align:left">透明通道是计算机图形学术语，指的是“非彩色”通道，8位灰度通道，使用256级灰度来记录图像中的透明信息，定义透明、不透明和半透明。如32位存储的图片，8红+8绿+8蓝+8透明；</td>
</tr>
<tr>
<td style="text-align:center">inDither</td>
<td style="text-align:left">抖动解码，默认false，标识不采用抖动解码；</td>
<td style="text-align:left">Bitmap解码是根据它所记录的节点，按照一定的算法来补充两个节点之间的数据，可理解为补充像素点的颜色。一张颜色丰富的图用一个位数比较低的颜色模式解码的话，会感觉颜色不够用，颜色渐变区域有明显断裂带。因为一些丰富的颜色在位数较低的颜色模式下并没有，只能用相近的颜色补充，可能一大片没有，那么这大片都用一个颜色填充，就形成了断裂色带；如果采用抖动解码，就会在这些颜色上采用随机噪声色来填充，这样显示效果更好，色带不那么明显。如果不想有这些色带，就需要采用抖动解码；</td>
</tr>
<tr>
<td style="text-align:center">inDensity</td>
<td style="text-align:left">表示这个bitmap的像素密度；</td>
<td style="text-align:left">对应DisplayMetrics.densityDpi，不是density</td>
</tr>
<tr>
<td style="text-align:center">inTargetDensity</td>
<td style="text-align:left">表示要被画出来时的目标像素密度；</td>
<td style="text-align:left">x</td>
</tr>
<tr>
<td style="text-align:center">inScreenDensity</td>
<td style="text-align:left">标识实际设备的像素密度；</td>
<td style="text-align:left">inDensity，inTargetDensity，inScreenDensity这三个值的目的就是为了确定这个Bitmap的宽高和density。详细算法可以查看setDensityFromOptions()方法源码实现；</td>
</tr>
<tr>
<td style="text-align:center">inScaled</td>
<td style="text-align:left">设置这个bitmap是否可以被缩放，默认true；</td>
<td style="text-align:left">x</td>
</tr>
<tr>
<td style="text-align:center">inPurgeable/inInputShareable</td>
<td style="text-align:left">一般一起使用，设置为true时，表示空间不够可以被释放，后者表示是否可以共享引用。Android5.0后被弃用；</td>
<td style="text-align:left">x</td>
</tr>
<tr>
<td style="text-align:center">outWidth/outHeight</td>
<td style="text-align:left">表示bitmap的宽和高，一般和inJustDecodeBounds一起使用获取Bitmap的宽高，但不加载到内存中；</td>
<td style="text-align:left">x</td>
</tr>
</table></div><h4 id="缩放图片的几种方式">缩放图片的几种方式</h4><pre><code>// 方式一 内部实现就是Matrix
inline fun Bitmap.scale(width: Int, height: Int, filter: Boolean = true): Bitmap {
    return Bitmap.createScaledBitmap(this, width, height, filter)
}

public static Bitmap createScaledBitmap(@NonNull Bitmap src, int dstWidth, int dstHeight,
        boolean filter) {
    Matrix m = new Matrix();

    final int width = src.getWidth();
    final int height = src.getHeight();
    if (width != dstWidth || height != dstHeight) {
        final float sx = dstWidth / (float) width;
        final float sy = dstHeight / (float) height;
        m.setScale(sx, sy);
    }
    return Bitmap.createBitmap(src, 0, 0, width, height, m, filter);
}

// 方式二
BitmapFactory.decodeStream(xxx, null, BitmapFactory.Options().apply {
            inPreferredConfig = Bitmap.Config.ARGB_8888
            inScaled = true
            inDensity = srcWidth
            inTargetDensity = dstWidth
        })
</code></pre><h3 id="去除边缘透明像素">去除边缘透明像素</h3><pre><code>fun Bitmap.clipTransparentEdge(): Bitmap {
    var left = 0
    var top = 0
    var right = width
    var bottom = height

    // 从边缘检测(比较快)
    // LEFT
    for (i in 0 until width) {
        var find = false
        for (j in 0 until height) {
            val color = getPixel(i, j)
            // 如果是透明像素
            if (Color.alpha(color) != 0) {
                left = i
                find = true
                break
            }
        }
        if (find) {
            break
        }
    }
    // TOP
    for (i in 0 until height) {
        var find = false
        for (j in 0 until width) {
            val color = getPixel(j, i)
            // 如果是透明像素
            if (Color.alpha(color) != 0) {
                top = i
                find = true
                break
            }
        }
        if (find) {
            break
        }
    }

    // RIGHT
    for (i in width - 1 downTo 0) {
        var find = false
        for (j in 0 until height) {
            val color = getPixel(i, j)
            // 如果是透明像素
            if (Color.alpha(color) != 0) {
                right = i
                find = true
                break
            }
        }
        if (find) {
            break
        }
    }

    // BOTTOM
    for (i in height - 1 downTo 0) {
        var find = false
        for (j in 0 until width) {
            val color = getPixel(j, i)
            // 如果是透明像素
            if (Color.alpha(color) != 0) {
                bottom = i
                find = true
                break
            }
        }
        if (find) {
            break
        }
    }

    return if (left == 0 &amp;&amp; top == 0 &amp;&amp; right == width &amp;&amp; bottom == height) {
        this
    } else {
        Log.d(&quot;BitmapX&quot;, &quot;{$width,$height},cut={$left,$top,${width - right},${height - bottom}}&quot;)
        Bitmap.createBitmap(this, left, top, right - left, bottom - top)
    }
}
</code></pre>
                                        </div>
                                    </article>
                                    <div class="article-end"
                                        data-v-5762947c data-v-125fc212>
                                        
                                    </div>
                                    <div
    data-v-738d100d
    data-v-125fc212
    data-jj-helper="comment-container"
    class="post-comment" data-v-5762947c>
    <link rel="stylesheet" href="../css/gitalk.css">
    
    <div class="message-card add-top" id="comment-card">
	<div class="gitalk_container">
		<div id="gitalk-container"></div>
		<link rel="stylesheet" href="https://unpkg.com/gitalk@latest/dist/gitalk.css"
			async>
		<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js" async></script>
		<script type="text/javascript">
			let initGitalk = ()=> {
				if (typeof(Gitalk) == 'undefined') {
                    setTimeout(initGitalk, 20);
                    return;
                } 
				let gitalk = new Gitalk({
				clientID: "7e48ff7dd55f15c9f051",
				clientSecret: "a5a35f0a17ee770eabd97358255ec6839486a7dd",
				repo: "gitalk.echo.engineer",
				owner: "Pluckypan",
				admin: "Pluckypan",
				distractionFreeMode: "true",
				labels: ['post']
			});
				gitalk.render('gitalk-container');
			}
			$(()=>{
				initGitalk();
			})
		</script>
	</div>
</div>
    
</div>
                                </div>
                                <div id="sidebar-container"
                                    class="sidebar article-sidebar"
                                    data-v-5a150454 data-v-125fc212
                                    data-v-5762947c>
                                    <div
    data-v-7e7e812a
    data-v-05741537
    data-v-5a150454
    class="sidebar-block wechat-sidebar-block pure wechat-ad">
    <div data-v-05741537 data-v-7e7e812a class="ad-container">
        <div data-v-05741537 data-v-7e7e812a class="text-container">
            <div data-v-05741537 data-v-7e7e812a class="text-description">
                找对属于你的技术圈子
            </div>

            <div data-v-05741537 data-v-7e7e812a class="text-reply">
                回复「进群」加入官方微信群
            </div>
        </div>
        <img
            data-v-05741537
            data-v-7e7e812a
            src="../assets/qrcode.png"
            loading="lazy"
            class="qr-code" />
    </div>
</div>

                                    <div class data-v-5a150454 id="jj_post_nav">
    <nav
        class="article-catalog catalog-block"
        data-v-6239701c
        data-v-16ed86c3
        data-v-5a150454>
        <div class="catalog-title" data-v-6239701c>
            <div data-v-6239701c>目录</div>
            <div class="direction" data-v-6239701c>
                <div class="word" data-v-6239701c>收起</div>
                <svg
                    id="icon_expand_toogle"
                    width="12"
                    height="12"
                    viewBox="0 0 12 12"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    class="icon-rotate"
                    data-v-6239701c>
                    <g
                        id="&amp;#229;&amp;#177;&amp;#149;&amp;#229;&amp;#188;&amp;#128;"
                        data-v-6239701c>
                        <path
                            id="&amp;#232;&amp;#183;&amp;#175;&amp;#229;&amp;#190;&amp;#132;"
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M5.99854 7.93206L10.0644 3.86619C10.162 3.76856 10.3203 3.76856 10.418 3.86619L10.7715 4.21975C10.8691 4.31738 10.8691 4.47567 10.7715 4.5733L6.35209 8.99272C6.15683 9.18798 5.84025 9.18798 5.64498 8.99272L1.22557 4.5733C1.12794 4.47567 1.12794 4.31738 1.22557 4.21975L1.57912 3.86619C1.67675 3.76856 1.83504 3.76856 1.93267 3.86619L5.99854 7.93206Z"
                            fill="#8A919F"
                            data-v-6239701c></path>
                    </g>
                </svg>
            </div>
        </div>
        <div class="catalog-body unfold" data-v-6239701c>
            <ul class="catalog-list" style="margin-top: 0px" data-v-6239701c>
                
                
                
            </ul>
        </div>
    </nav>

    <script type="text/javascript">
        $(".catalog-aTag").click(function(){
            let id = $(this).attr("target_id");
            $('html, body').animate({
                scrollTop: ($(id).offset().top-80)
            }, 798);
        });
        $(".direction").click(function(){
            $(".catalog-title").removeClass("collapse");
            $("#icon_expand_toogle").attr('class', "");
            if ($(".catalog-body").hasClass("fold")) {
                $(".catalog-body").removeClass("fold");
                $(".catalog-body").addClass("unfold");
                $(".direction>.word").text("收起");
                $("#icon_expand_toogle").attr('class', "icon-rotate");
            }else{
                $(".catalog-body").removeClass("unfold");
                $(".catalog-body").addClass("fold");
                $(".catalog-title").addClass("collapse");
                $(".direction>.word").text("展开");
            }
        });
        $(()=>{
            let tocArray = "";
            let fixedTop = $("#jj_post_nav").offset().top;
            let stickyNav = ()=> {
                let scrollTop = $(window).scrollTop();
                // console.log(`scrollTop=${scrollTop} fixedTop=${fixedTop}`);
                if (scrollTop>fixedTop) {
                    $("#jj_post_nav").addClass("jj_sticky");
                } else {
                    $("#jj_post_nav").removeClass("jj_sticky");
                }
            };
            stickyNav();
            $(window).scroll(()=>{
                stickyNav();
            });
            $("#jj_post_nav").css("display",tocArray.length==0?"none":"");
        });
    </script>

</div>

                                </div>
                                <div data-v-125fc212
    class="article-suspended-panel dynamic-data-ready">
    <svg
        data-v-45561e54
        xmlns="http://www.w3.org/2000/svg"
        class
        style="display: none;">
        <symbol
            data-v-45561e54
            id="icon-comment"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg">
            <path
                data-v-45561e54
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.62739 1.25C2.9347 1.25 1.5625 2.6222 1.5625 4.31489L1.56396 12.643C1.56403 14.3356 2.9362 15.7078 4.62885 15.7078H6.48326L6.93691 17.6869L6.93884 17.6948C7.16894 18.6441 8.28598 19.0599 9.08073 18.4921L12.7965 15.7078H15.5001C17.1928 15.7078 18.565 14.3355 18.565 12.6428L18.5635 4.31477C18.5635 2.62213 17.1913 1.25 15.4986 1.25H4.62739ZM5.98265 9.89255C6.68783 9.89255 7.2595 9.32089 7.2595 8.61571C7.2595 7.91053 6.68783 7.33887 5.98265 7.33887C5.27747 7.33887 4.70581 7.91053 4.70581 8.61571C4.70581 9.32089 5.27747 9.89255 5.98265 9.89255ZM9.95604 9.89255C10.6612 9.89255 11.2329 9.32089 11.2329 8.61571C11.2329 7.91053 10.6612 7.33887 9.95604 7.33887C9.25086 7.33887 8.6792 7.91053 8.6792 8.61571C8.6792 9.32089 9.25086 9.89255 9.95604 9.89255ZM15.2124 8.61571C15.2124 9.32089 14.6407 9.89255 13.9355 9.89255C13.2304 9.89255 12.6587 9.32089 12.6587 8.61571C12.6587 7.91053 13.2304 7.33887 13.9355 7.33887C14.6407 7.33887 15.2124 7.91053 15.2124 8.61571Z"></path>
        </symbol>
        <symbol
            data-v-45561e54 id="icon-zan"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg">
            <path
                data-v-45561e54
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M10.4167 6.40399C5.35406 6.40399 1.25 10.5675 1.25 15.7035C1.25 16.0225 1.28448 16.4512 1.35344 16.9898C1.36807 17.1039 1.47243 17.1846 1.58655 17.17C1.6483 17.1621 1.70328 17.127 1.73643 17.0743L1.86865 16.8676C1.99553 16.6731 2.10644 16.5147 2.20137 16.3925C3.69554 14.4692 6.13777 13.3823 9.35515 13.3378L10.4167 13.3364V17.0757C10.4167 17.3101 10.6086 17.5 10.8453 17.5C10.959 17.5 11.068 17.4553 11.1483 17.3757L18.145 10.45C18.3961 10.2015 18.3961 9.79853 18.145 9.55L11.1483 2.62426C10.981 2.45858 10.7096 2.45858 10.5422 2.62426C10.4618 2.70383 10.4167 2.81174 10.4167 2.92426V6.40399Z"></path>
        </symbol>
        <symbol
            data-v-45561e54
            id="icon-immerse"
            viewBox="0 0 1024 1024"
            xmlns="http://www.w3.org/2000/svg">
            <path
                data-v-45561e54
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M535.466667 241.066667c-12.8-8.533333-27.733333-8.533333-40.533334 0L183.466667 488.533333c-6.4 6.4-12.8 14.933333-12.8 23.466667 0 2.133333 0 6.4 2.133333 8.533333 2.133333 12.8 14.933333 21.333333 27.733333 21.333334h155.733334v322.133333c0 19.2 12.8 29.866667 32 29.866667h249.6c21.333333 0 34.133333-12.8 34.133333-29.866667v-320h151.466667c12.8 0 25.6-8.533333 27.733333-21.333333s0-25.6-8.533333-34.133334L535.466667 241.066667zM864 96h-704C142.933333 96 128 110.933333 128 128s14.933333 32 32 32h704c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32z"></path>
        </symbol>
    </svg>
    <div data-v-45561e54 badge="222"
        class="panel-btn with-badge-x">
        <svg
            data-v-6e70c50a
            data-v-45561e54
            class="sprite-icon icon-zan">
            <use
                data-v-6e70c50a
                xlink:href="#icon-zan">
            </use>
        </svg>
    </div>
    <div data-v-45561e54 badge="109"
        class="panel-btn with-badge-x" id="toolbar_btn_comment">
        <svg
            data-v-6e70c50a data-v-45561e54
            class="sprite-icon icon-comment">
            <use
                data-v-6e70c50a
                xlink:href="#icon-comment">
            </use>
        </svg>
    </div>
    <div data-v-45561e54 class="panel-btn" id="toolbar_btn_top">
        <svg
            data-v-6e70c50a
            data-v-45561e54
            class="sprite-icon icon-report">
            <use
                data-v-6e70c50a
                xlink:href="#icon-immerse">
            </use>
        </svg>
    </div>
    <script type="text/javascript">
        $("#toolbar_btn_comment").click(()=>{
            $('html, body').animate({
                scrollTop: ($('#comment-card').offset().top - 120)
            }, 798);
        });
        $("#toolbar_btn_top").click(()=>{
            $('html, body').animate({
                scrollTop: 0
            }, 798);
        });
    </script>
</div>
                            </div>
                        </main>
                    </div>
                    <div class="global-component-box">

                    </div>

                </div>
            </div>
        </div>
    </body>

</html>